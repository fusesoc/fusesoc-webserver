{% extends "web_ui/base.html" %}
{% load static %}
{% block title %}{{ core }}{% endblock %}
{% block meta_description %}{{ core.description|default:core.project.description }}{% endblock %}
{% block og_title %} View {{ core }} on FuseSoC Package Directory{% endblock %}
{% block og_description %}{{ core.description|default:core.project.description }}{% endblock %}
{% block extra_head %}
    <script src="{% static 'js/expandable_section.js' %}"></script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareSourceCode",
        "name": "{{ core.project.name|escapejs }}",
        "version": "{{ core.version|escapejs }}",
        "description": "{{ core.description|escapejs }}",
        "url": "{{ request.build_absolute_uri }}",
        "license": "{{ core.get_license_url|default:''|escapejs }}",
        "author": {
            "@type": "Organization",
            "name": "{{ core.project.vendor.name|escapejs }}"
        }   
    }
    </script>
    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'landing' %}"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Vendors",
        "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'vendor-list' %}"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "{{ core.project.vendor.name|escapejs }}",
        "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'vendor-detail' sanitized_name=core.project.vendor.sanitized_name %}"
        },
        {
        "@type": "ListItem",
        "position": 4,
        "name": "{{ core.project.name|escapejs }} v{{ core.version|escapejs }}",
        "item": "{{ request.build_absolute_uri }}"
        }
    ]
    }
    </script>
{% endblock %}
{% block content %}
    <div class="card shadow-sm mb-4">
        {% include "web_ui/includes/card_header.html" with icon="bi bi-box" title=core %}
        <div class="card-body">
            <div class="section-card mb-3 border rounded">
                <div class="section-header"><i class="bi bi-files me-2"></i> Details</div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>
                            Vendor:
                            <a href="{% url 'vendor-detail' sanitized_name=core.project.vendor.sanitized_name %}" class="section-link">
                                {{ core.project.vendor }}
                            </a>
                        </strong>
                    </div>
                    <div class="mb-3">
                        <strong>Description:</strong>
                        <div class="text-muted">{{ core.description }}</div>
                    </div>
                    <div class="mb-3">
                        {% if core.spdx_license %}
                            {% if core.get_license_url %}
                                <a href="{{ core.get_license_url }}" class="badge bg-success" target="_blank">
                                <i class="bi bi-file-earmark-medical" aria-hidden="true"></i>
                                License: {{ core.spdx_license }}
                                </a>
                            {% else %}
                                <span class="badge bg-warning" title="Custom or unknown license">
                                <i class="bi bi-file-earmark-text" aria-hidden="true"></i>
                                License: {{ core.spdx_license }}
                                </span>
                            {% endif %}
                            {% else %}
                            <span class="badge bg-secondary" title="No license specified">
                                <i class="bi bi-file-earmark-x" aria-hidden="true"></i>
                                License unknown
                            </span>
                            {% endif %}
                        {% if core.is_signed %}
                            <span class="badge bg-success">
                            <i class="bi bi-shield-check"></i>
                                signed
                            </span>
                        {% else %}
                            <span class="badge bg-danger">
                            <i class="bi bi-shield-exclamation"></i>
                                unsigned
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="section-card mb-3 border rounded">
                <div class="section-header"><i class="bi bi-files me-2"></i> Files</div>
                <div class="section-content p-3" style="display:block">
                    <a href="{{ core.core_file.url }}" class="btn btn-outline-primary btn-sm me-1" title="Download .core file">
                        <i class="bi bi-file-earmark-code"></i> .core
                    </a>
                    {% if core.is_signed %}
                    <a href="{{ core.signature_file.url }}" class="btn btn-outline-secondary btn-sm" title="Download .sig file">
                        <i class="bi bi-file-earmark-medical"></i> .sig
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="section-card mb-3 border rounded collapsible">
                <div class="section-header"><i class="bi bi-motherboard me-2"></i> Targets</div>
                <div class="section-content p-3" style="display:block">
                {% for item in targets_with_deps %}
                    {% with target_configuration=item.target_configuration dependencies=item.dependencies %}
                    <div class="section-card mb-3 border rounded collapsible" data-collapsed="true">
                        <div class="section-header p-2 bg-light d-flex align-items-center">
                            <button type="button" class="expand-toggle btn btn-link p-0 me-2" aria-label="Expand/collapse library"></button>
                            <b>{{ target_configuration.target }}</b>
                        </div>
                        <div class="section-content p-3" style="display:none;">
                            <table class="table table-sm mb-0">
                                <colgroup>
                                    <col style="width:20%;">
                                    <col style="width:80%;">
                                </colgroup>
                                {% if target_configuration.description %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Description:</td>
                                    <td>{{ target_configuration.description }}</td>
                                </tr>
                                {% endif %}
                                {% if target_configuration.flow %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Flow:</td>
                                    <td>{{ target_configuration.flow }}</td>
                                </tr>
                                {% elif target_configuration.default_tool %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Default tool:</td>
                                    <td>{{ target_configuration.default_tool }}</td>
                                </tr>
                                {% endif %}
                                {% if target_configuration.parameters %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Parameters:</td>
                                    <td>
                                        {% for parameter in target_configuration.parameters %}
                                            <span class="badge badge-secondary me-1">{{ parameter }}</span>
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endif %}
                                {% if item.filetypes %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Filetypes:</td>
                                    <td>
                                        {% for filetype in item.filetypes %}
                                            <span class="badge bg-light text-dark border me-1">{{ filetype }}</span>
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td class="fw-bold text-nowrap">Dependencies:</td>
                                    <td>
                                        {% if dependencies %}
                                            {% for dependency in dependencies %}
                                                <a href="{% url 'core-package-list' %}?search={{ dependency }}" class="badge bg-light me-1 text-dark">{{ dependency }}</a>
                                            {% endfor %}
                                        {% else %}
                                            <span class="text-muted">None</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    {% endwith %}
                {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}